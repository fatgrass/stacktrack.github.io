---
layout: default
title: StackTrack
---

		<div class="blurb">
			<h1>StackTrack</h1>
            <h2>Introduction</h2>
            <p>When browsing large codebases, it is often unclear how a certain function can be reached. StackTrack tries to solve this problem for the linux kernel by generating call graphs. We then use dynamic instrumentation to generate code to reach different parts of the code.
            An example graph showing the codepath for the sys_chdir system call can be found <a href="http://stacktrack.github.io/tree.html?json=sys_chdir.json&trace=chdir_trace.json">here</a>.

            </p>
            <h2>Overview and Setup</h2>
            <p>
            The source code for this project is available in the <a href=https://github.com/stacktrack/stacktrack.github.com>github repository</a> . To test the tracing you will need a linux kernel with debug symbols and a gdb session. The graph generating code is written in python and uses a mysql server.
            </p>

            <h2>Cross Reference Database, Graph Datastructure and Visualization</h2> 
            <p>
            A function call cross reference database table was built by parsing the output of the <a href=http://www.gson.org/egypt/egypt.html>egypt</a> tool. This mysql database dump can be downloaded <a href="database/stacktrack.sql">here</a>. It consists of a single table with two columns: caller and callee.
            </p>
            <p>
            The <a href="https://github.com/stacktrack/stacktrack.github.com/blob/master/src/Graph.py">Graph.py</a> python script creates a "Graph" datastructure based on this table. This graph consists of nodes and edges. The graph information can be exported in json format with the dump_node(s) method.
            </p>

            <p>
            The json graph output is rendered using the <a>d3js</a> javascript library. 
            </p>

            <h2>Tracing</h2>
            <!--{% gist 8387126 %}-->
{% highlight python linenos=table%}
blah
{% endhighlight %}


{% highlight python linenos=table %}
class KxrBreakpoint(gdb.Breakpoint):

    bplist   = set()
    todelete = []
    edges    = []
    graph    = Graph()

    def __init__(self, func_name, parent=None):

        self.func_name = func_name
        self.parent    = parent
        KxrBreakpoint.bplist.add(func_name)
        super(KxrBreakpoint, self).__init__(
            func_name, gdb.BP_BREAKPOINT, internal=False
        )

    def stop(self):
        comm = get_current()['comm'].string()
        if not comm.startswith('trinity'):
            return

        if self.parent:
            KxrBreakpoint.graph.add_edge(self.parent,self.func_name)

        for bp in KxrBreakpoint.todelete:
            try:
                if bp.func_name != self.func_name:
                    bp.delete()
            except:
                pass


        #callees = [ c.name for c in self.node.get_callees()]

        for callee in get_callees(self.func_name):
            self.edges += [(self.func_name,callee)]
            if callee not in KxrBreakpoint.bplist:
                KxrBreakpoint(callee,self.func_name)

        KxrBreakpoint.todelete += [self]

{% endhighlight %}


            <p>
            <li>
            <ul>Example with dynamic tracing of chdir("/")<a href=http://stacktrack.github.io/tree.html?json=sys_chdir.json>sys_chdir</a></ul>
            </li>


<a href="/tree.html?json=sys_accept.json">sys_accept</a>
<a href="/tree.html?json=sys_acct.json">sys_acct</a>
<a href="/tree.html?json=sys_adjtimex.json">sys_adjtimex</a>
<a href="/tree.html?json=sys_arch_prctl.json">sys_arch_prctl</a>
<a href="/tree.html?json=sys_bpf.json">sys_bpf</a>
<a href="/tree.html?json=sys_capget.json">sys_capget</a>
<a href="/tree.html?json=sys_capset.json">sys_capset</a>
<a href="/tree.html?json=sys_chdir.json">sys_chdir</a>
<a href="/tree.html?json=sys_chmod.json">sys_chmod</a>
<a href="/tree.html?json=sys_chown.json">sys_chown</a>
<a href="/tree.html?json=sys_clock_nanosleep.json">sys_clock_nanosleep</a>
<a href="/tree.html?json=sys_connect.json">sys_connect</a>
<a href="/tree.html?json=sys_creat.json">sys_creat</a>
<a href="/tree.html?json=sys_delete_module.json">sys_delete_module</a>
<a href="/tree.html?json=sys_dup2.json">sys_dup2</a>
<a href="/tree.html?json=sys_dup.json">sys_dup</a>
<a href="/tree.html?json=sys_epoll_create.json">sys_epoll_create</a>
<a href="/tree.html?json=sys_epoll_ctl.json">sys_epoll_ctl</a>
<a href="/tree.html?json=sys_epoll_wait.json">sys_epoll_wait</a>
<a href="/tree.html?json=sys_execve.json">sys_execve</a>
<a href="/tree.html?json=sys_exit_group.json">sys_exit_group</a>
<a href="/tree.html?json=sys_exit.json">sys_exit</a>
<a href="/tree.html?json=sys_faccessat.json">sys_faccessat</a>
<a href="/tree.html?json=sys_fadvise64.json">sys_fadvise64</a>
<a href="/tree.html?json=sys_fchdir.json">sys_fchdir</a>
<a href="/tree.html?json=sys_fchmodat.json">sys_fchmodat</a>
<a href="/tree.html?json=sys_fchmod.json">sys_fchmod</a>
<a href="/tree.html?json=sys_fchown16.json">sys_fchown16</a>
<a href="/tree.html?json=sys_fchownat.json">sys_fchownat</a>
<a href="/tree.html?json=sys_fcntl.json">sys_fcntl</a>
<a href="/tree.html?json=sys_fdatasync.json">sys_fdatasync</a>
<a href="/tree.html?json=sys_flistxattr.json">sys_flistxattr</a>
<a href="/tree.html?json=sys_flock.json">sys_flock</a>
<a href="/tree.html?json=sys_fremovexattr.json">sys_fremovexattr</a>
<a href="/tree.html?json=sys_fsync.json">sys_fsync</a>
<a href="/tree.html?json=sys_ftruncate.json">sys_ftruncate</a>
<a href="/tree.html?json=sys_futex.json">sys_futex</a>
<a href="/tree.html?json=sys_getcwd.json">sys_getcwd</a>
<a href="/tree.html?json=sys_getdents.json">sys_getdents</a>
<a href="/tree.html?json=sys_geteuid16.json">sys_geteuid16</a>
<a href="/tree.html?json=sys_getgid16.json">sys_getgid16</a>
<a href="/tree.html?json=sys_getpeername.json">sys_getpeername</a>
<a href="/tree.html?json=sys_getpgid.json">sys_getpgid</a>
<a href="/tree.html?json=sys_getpriority.json">sys_getpriority</a>
<a href="/tree.html?json=sys_getrandom.json">sys_getrandom</a>
<a href="/tree.html?json=sys_getresuid16.json">sys_getresuid16</a>
<a href="/tree.html?json=sys_getsockopt.json">sys_getsockopt</a>
<a href="/tree.html?json=sys_gettid.json">sys_gettid</a>
<a href="/tree.html?json=sys_getuid.json">sys_getuid</a>
<a href="/tree.html?json=sys_init_module.json">sys_init_module</a>
<a href="/tree.html?json=sys_inotify_init.json">sys_inotify_init</a>
<a href="/tree.html?json=sys_inotify_rm_watch.json">sys_inotify_rm_watch</a>
<a href="/tree.html?json=sys_ioctl.json">sys_ioctl</a>
<a href="/tree.html?json=sys_iopl.json">sys_iopl</a>
<a href="/tree.html?json=sys_ioprio_get.json">sys_ioprio_get</a>
<a href="/tree.html?json=sys_io_setup.json">sys_io_setup</a>
<a href="/tree.html?json=sys_io_submit.json">sys_io_submit</a>
<a href="/tree.html?json=sys_kcmp.json">sys_kcmp</a>
<a href="/tree.html?json=sys_kexec_file_load.json">sys_kexec_file_load</a>
<a href="/tree.html?json=sys_kexec_load.json">sys_kexec_load</a>
<a href="/tree.html?json=sys_lchown.json">sys_lchown</a>
<a href="/tree.html?json=sys_lgetxattr.json">sys_lgetxattr</a>
<a href="/tree.html?json=sys_linkat.json">sys_linkat</a>
<a href="/tree.html?json=sys_llistxattr.json">sys_llistxattr</a>
<a href="/tree.html?json=sys_lookup_dcookie.json">sys_lookup_dcookie</a>
<a href="/tree.html?json=sys_lremovexattr.json">sys_lremovexattr</a>
<a href="/tree.html?json=sys_lseek.json">sys_lseek</a>
<a href="/tree.html?json=sys_mbind.json">sys_mbind</a>
<a href="/tree.html?json=sys_mincore.json">sys_mincore</a>
<a href="/tree.html?json=sys_mknodat.json">sys_mknodat</a>
<a href="/tree.html?json=sys_mknod.json">sys_mknod</a>
<a href="/tree.html?json=sys_mlockall.json">sys_mlockall</a>
<a href="/tree.html?json=sys_mlock.json">sys_mlock</a>
<a href="/tree.html?json=sys_mmap.json">sys_mmap</a>
<a href="/tree.html?json=sys_mmap_pgoff.json">sys_mmap_pgoff</a>
<a href="/tree.html?json=sys_move_pages.json">sys_move_pages</a>
<a href="/tree.html?json=sys_mq_notify.json">sys_mq_notify</a>
<a href="/tree.html?json=sys_mq_timedsend.json">sys_mq_timedsend</a>
<a href="/tree.html?json=sys_mremap.json">sys_mremap</a>
<a href="/tree.html?json=sys_msgsnd.json">sys_msgsnd</a>
<a href="/tree.html?json=sys_munlockall.json">sys_munlockall</a>
<a href="/tree.html?json=sys_munmap.json">sys_munmap</a>
<a href="/tree.html?json=sys_name_to_handle_at.json">sys_name_to_handle_at</a>
<a href="/tree.html?json=sys_nanosleep.json">sys_nanosleep</a>
<a href="/tree.html?json=sys_newfstatat.json">sys_newfstatat</a>
<a href="/tree.html?json=sys_newlstat.json">sys_newlstat</a>
<a href="/tree.html?json=sys_newstat.json">sys_newstat</a>
<a href="/tree.html?json=sys_ni_syscall.json">sys_ni_syscall</a>
<a href="/tree.html?json=sys_old_getrlimit.json">sys_old_getrlimit</a>
<a href="/tree.html?json=sys_oldumount.json">sys_oldumount</a>
<a href="/tree.html?json=sys_openat.json">sys_openat</a>
<a href="/tree.html?json=sys_open.json">sys_open</a>
<a href="/tree.html?json=sys_pause.json">sys_pause</a>
<a href="/tree.html?json=sys_pciconfig_iobase.json">sys_pciconfig_iobase</a>
<a href="/tree.html?json=sys_pciconfig_read.json">sys_pciconfig_read</a>
<a href="/tree.html?json=sys_perf_event_open.json">sys_perf_event_open</a>
<a href="/tree.html?json=sys_personality.json">sys_personality</a>
<a href="/tree.html?json=sys_pipe.json">sys_pipe</a>
<a href="/tree.html?json=sys_poll.json">sys_poll</a>
<a href="/tree.html?json=sys_prlimit64.json">sys_prlimit64</a>
<a href="/tree.html?json=sys_process_vm_readv.json">sys_process_vm_readv</a>
<a href="/tree.html?json=sys_process_vm_writev.json">sys_process_vm_writev</a>
<a href="/tree.html?json=sys_ptrace.json">sys_ptrace</a>
<a href="/tree.html?json=sys_quotactl.json">sys_quotactl</a>
<a href="/tree.html?json=sys_readahead.json">sys_readahead</a>
<a href="/tree.html?json=sys_read.json">sys_read</a>
<a href="/tree.html?json=sys_readlinkat.json">sys_readlinkat</a>
<a href="/tree.html?json=sys_readv.json">sys_readv</a>
<a href="/tree.html?json=sys_recvfrom.json">sys_recvfrom</a>
<a href="/tree.html?json=sys_removexattr.json">sys_removexattr</a>
<a href="/tree.html?json=sys_request_key.json">sys_request_key</a>
<a href="/tree.html?json=sys_restart_syscall.json">sys_restart_syscall</a>
<a href="/tree.html?json=sys_rmdir.json">sys_rmdir</a>
<a href="/tree.html?json=sys_rt_sigpending.json">sys_rt_sigpending</a>
<a href="/tree.html?json=sys_rt_sigqueueinfo.json">sys_rt_sigqueueinfo</a>
<a href="/tree.html?json=sys_rt_sigtimedwait.json">sys_rt_sigtimedwait</a>
<a href="/tree.html?json=sys_s390_pci_mmio_read.json">sys_s390_pci_mmio_read</a>
<a href="/tree.html?json=sys_sched_getaffinity.json">sys_sched_getaffinity</a>
<a href="/tree.html?json=sys_sched_getparam.json">sys_sched_getparam</a>
<a href="/tree.html?json=sys_sched_get_priority_max.json">sys_sched_get_priority_max</a>
<a href="/tree.html?json=sys_sched_getscheduler.json">sys_sched_getscheduler</a>
<a href="/tree.html?json=sys_sched_setaffinity.json">sys_sched_setaffinity</a>
<a href="/tree.html?json=sys_sched_setattr.json">sys_sched_setattr</a>
<a href="/tree.html?json=sys_sched_setparam.json">sys_sched_setparam</a>
<a href="/tree.html?json=sys_sched_setscheduler.json">sys_sched_setscheduler</a>
<a href="/tree.html?json=sys_seccomp.json">sys_seccomp</a>
<a href="/tree.html?json=sys_semctl.json">sys_semctl</a>
<a href="/tree.html?json=sys_semget.json">sys_semget</a>
<a href="/tree.html?json=sys_semop.json">sys_semop</a>
<a href="/tree.html?json=sys_semtimedop.json">sys_semtimedop</a>
<a href="/tree.html?json=sys_send.json">sys_send</a>
<a href="/tree.html?json=sys_sendto.json">sys_sendto</a>
<a href="/tree.html?json=sys_setdomainname.json">sys_setdomainname</a>
<a href="/tree.html?json=sys_setfsgid16.json">sys_setfsgid16</a>
<a href="/tree.html?json=sys_setfsgid.json">sys_setfsgid</a>
<a href="/tree.html?json=sys_setfsuid16.json">sys_setfsuid16</a>
<a href="/tree.html?json=sys_setgid16.json">sys_setgid16</a>
<a href="/tree.html?json=sys_setgroups16.json">sys_setgroups16</a>
<a href="/tree.html?json=sys_setgroups.json">sys_setgroups</a>
<a href="/tree.html?json=sys_setitimer.json">sys_setitimer</a>
<a href="/tree.html?json=sys_set_mempolicy.json">sys_set_mempolicy</a>
<a href="/tree.html?json=sys_setns.json">sys_setns</a>
<a href="/tree.html?json=sys_setpgid.json">sys_setpgid</a>
<a href="/tree.html?json=sys_setpriority.json">sys_setpriority</a>
<a href="/tree.html?json=sys_setregid16.json">sys_setregid16</a>
<a href="/tree.html?json=sys_setregid.json">sys_setregid</a>
<a href="/tree.html?json=sys_setresgid16.json">sys_setresgid16</a>
<a href="/tree.html?json=sys_setresgid.json">sys_setresgid</a>
<a href="/tree.html?json=sys_setresuid.json">sys_setresuid</a>
<a href="/tree.html?json=sys_set_robust_list.json">sys_set_robust_list</a>
<a href="/tree.html?json=sys_set_thread_area.json">sys_set_thread_area</a>
<a href="/tree.html?json=sys_setuid16.json">sys_setuid16</a>
<a href="/tree.html?json=sys_setuid.json">sys_setuid</a>
<a href="/tree.html?json=sys_setxattr.json">sys_setxattr</a>
<a href="/tree.html?json=sys_shmat.json">sys_shmat</a>
<a href="/tree.html?json=sys_shmctl.json">sys_shmctl</a>
<a href="/tree.html?json=sys_shmdt.json">sys_shmdt</a>
<a href="/tree.html?json=sys_signalfd4.json">sys_signalfd4</a>
<a href="/tree.html?json=sys_signal.json">sys_signal</a>
<a href="/tree.html?json=sys_sigpending.json">sys_sigpending</a>
<a href="/tree.html?json=sys_sigsuspend.json">sys_sigsuspend</a>
<a href="/tree.html?json=sys_socketcall.json">sys_socketcall</a>
<a href="/tree.html?json=sys_socketpair.json">sys_socketpair</a>
<a href="/tree.html?json=sys_spu_create.json">sys_spu_create</a>
<a href="/tree.html?json=sys_ssetmask.json">sys_ssetmask</a>
<a href="/tree.html?json=sys_statfs64.json">sys_statfs64</a>
<a href="/tree.html?json=sys_statfs.json">sys_statfs</a>
<a href="/tree.html?json=sys_subpage_prot.json">sys_subpage_prot</a>
<a href="/tree.html?json=sys_swapoff.json">sys_swapoff</a>
<a href="/tree.html?json=sys_symlinkat.json">sys_symlinkat</a>
<a href="/tree.html?json=sys_symlink.json">sys_symlink</a>
<a href="/tree.html?json=sys_sysctl.json">sys_sysctl</a>
<a href="/tree.html?json=sys_sysfs.json">sys_sysfs</a>
<a href="/tree.html?json=sys_sysinfo.json">sys_sysinfo</a>
<a href="/tree.html?json=sys_syslog.json">sys_syslog</a>
<a href="/tree.html?json=sys_tgkill.json">sys_tgkill</a>
<a href="/tree.html?json=sys_timer_create.json">sys_timer_create</a>
<a href="/tree.html?json=sys_timerfd_create.json">sys_timerfd_create</a>
<a href="/tree.html?json=sys_timerfd_gettime.json">sys_timerfd_gettime</a>
<a href="/tree.html?json=sys_timerfd_settime.json">sys_timerfd_settime</a>
<a href="/tree.html?json=sys_timer_gettime.json">sys_timer_gettime</a>
<a href="/tree.html?json=sys_timer_settime.json">sys_timer_settime</a>
<a href="/tree.html?json=sys_times.json">sys_times</a>
<a href="/tree.html?json=sys_tkill.json">sys_tkill</a>
<a href="/tree.html?json=sys_umask.json">sys_umask</a>
<a href="/tree.html?json=sys_unshare.json">sys_unshare</a>
<a href="/tree.html?json=sys_utime.json">sys_utime</a>
<a href="/tree.html?json=sys_utimensat.json">sys_utimensat</a>
<a href="/tree.html?json=sys_utimes.json">sys_utimes</a>
<a href="/tree.html?json=sys_vfork.json">sys_vfork</a>
<a href="/tree.html?json=sys_vhangup.json">sys_vhangup</a>
<a href="/tree.html?json=sys_vm86old.json">sys_vm86old</a>
<a href="/tree.html?json=sys_wait4.json">sys_wait4</a>
<a href="/tree.html?json=sys_waitpid.json">sys_waitpid</a>
<a href="/tree.html?json=sys_write.json">sys_write</a>


		</div> 
